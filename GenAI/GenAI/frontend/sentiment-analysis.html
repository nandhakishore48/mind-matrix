<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis ‚Äî BrandCraft</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app-layout">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="main-content">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="page-header fade-in">
                <h1>üìà Sentiment Analysis</h1>
                <p>Analyze brand perception from customer reviews and feedback using NLP.</p>
            </div>

            <div class="card fade-in" style="max-width: 700px;">
                <h3 style="margin-bottom: 20px;">Input Text for Analysis</h3>
                <form id="sentimentForm" onsubmit="analyzeSentiment(event)">
                    <div class="form-group">
                        <label for="text">Paste reviews, feedback, or customer comments</label>
                        <textarea id="text" class="form-control" rows="8"
                            placeholder="e.g. I love this product! The quality is amazing and shipping was fast. However, the price is a bit high compared to competitors..."
                            required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;"
                        id="analyzeBtn">
                        üìà Analyze Sentiment
                    </button>
                </form>
            </div>

            <div class="spinner" id="spinner"></div>
            <div id="results" style="margin-top: 32px;"></div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!requireAuth()) return;
            renderSidebar('sentiment-analysis');
        });

        async function analyzeSentiment(e) {
            e.preventDefault();
            const btn = document.getElementById('analyzeBtn');
            btn.textContent = '‚è≥ Analyzing...';
            btn.disabled = true;
            showSpinner('spinner');

            try {
                const data = await api('/sentiment-analyze', {
                    method: 'POST',
                    body: JSON.stringify({
                        text: document.getElementById('text').value
                    })
                });

                const total = data.positive + data.neutral + data.negative;

                let html = `
                    <div class="two-col">
                        <!-- Pie Chart -->
                        <div class="card" style="text-align:center;">
                            <h3 style="margin-bottom:20px;">Sentiment Distribution</h3>
                            <div class="pie-chart" style="background: conic-gradient(
                                #00b894 0% ${data.positive}%,
                                #74b9ff ${data.positive}% ${data.positive + data.neutral}%,
                                #e17055 ${data.positive + data.neutral}% 100%
                            );"></div>
                            <div class="pie-legend">
                                <div class="legend-item"><div class="legend-dot" style="background:#00b894;"></div> Positive ${data.positive}%</div>
                                <div class="legend-item"><div class="legend-dot" style="background:#74b9ff;"></div> Neutral ${data.neutral}%</div>
                                <div class="legend-item"><div class="legend-dot" style="background:#e17055;"></div> Negative ${data.negative}%</div>
                            </div>
                        </div>

                        <!-- Bar Chart -->
                        <div class="card">
                            <h3 style="margin-bottom:20px;">Sentiment Breakdown</h3>
                            <div class="bar-chart" style="margin-bottom: 40px;">
                                <div class="bar" style="height:${data.positive * 2}px; background: linear-gradient(to top, #00b894, #55efc4);">
                                    <div class="bar-value" style="color:#00b894;">${data.positive}%</div>
                                    <div class="bar-label">Positive</div>
                                </div>
                                <div class="bar" style="height:${data.neutral * 2}px; background: linear-gradient(to top, #74b9ff, #a29bfe);">
                                    <div class="bar-value" style="color:#74b9ff;">${data.neutral}%</div>
                                    <div class="bar-label">Neutral</div>
                                </div>
                                <div class="bar" style="height:${data.negative * 2}px; background: linear-gradient(to top, #e17055, #fd79a8);">
                                    <div class="bar-value" style="color:#e17055;">${data.negative}%</div>
                                    <div class="bar-label">Negative</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Perception Score -->
                    <div class="card" style="text-align:center; margin-top:24px;">
                        <h3 style="margin-bottom:16px;">Brand Perception Score</h3>
                        <div class="score-circle" data-score="${data.brand_perception_score}" style="--score-pct: ${data.brand_perception_score * 10}%;"></div>
                        <p style="color:var(--text-secondary); margin-top:8px;">${data.brand_perception_score}/10 ‚Äî ${data.brand_perception_score >= 7 ? 'üü¢ Strong' : data.brand_perception_score >= 4 ? 'üü° Moderate' : 'üî¥ Needs Improvement'}</p>
                    </div>

                    <!-- AI Suggestions -->
                    <div class="card" style="margin-top:24px;">
                        <h3 style="margin-bottom:16px;">üí° AI Improvement Suggestions</h3>
                        <ul class="suggestions-list">
                            ${data.suggestions.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
            } catch (err) {
                showToast(err.message, 'error');
            }

            hideSpinner('spinner');
            btn.textContent = 'üìà Analyze Sentiment';
            btn.disabled = false;
        }
    </script>
</body>

</html>